{% extends "suppliers/sup_layout.html" %}
{% block content %}

<style>
    body{margin-top:80px}

    img{max-width:300px}

    .change
{
    cursor: pointer;
}
</style>

<div class="card">
    <div class="card-body">
        <h4 class="card-title">My Account</h4>
        <hr>
        <div class="container">
            <div class="row">
                <div class="col">
                    <img src="{{supplier.photo}}">
                    <form method="post" action="" enctype="multipart/form-data" id="myform">
                        <div id='preview' class='preview'>
                            <h2 class="text-center">Preview :</h2>
                            <img src="" id="img" class='product_img product_pic'>
                        </div>
                        <div id='photo_upload' class="custom-file">
                            <input class="custom-file-input" id="file" name="file" type="file">
                            <label class="custom-file-label" for="file">Product picture</label>
                            <div class="justify-content-center m-2 row" >
                                <input type="button" class="button" value="Upload" id="but_upload">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col">
                    <p>Name :<input class="form-control" type="text" id='name' disabled  value="{{supplier.name}}">  <span> <i id='name_edit' data-sibling='name_confirm' data-change='name'  class="fas fa-edit change"></i><i id='name_confirm' data-sibling='name_edit' data-change='name' class="fas fa-check-circle change confirm" style="display: none;"></i> </span> </p>

                    <p>Email :<input class="form-control" type="text" id='email' disabled  value="{{supplier.email}}">  <span> <i id='email_edit' data-sibling='email_confirm' data-change='email'  class="fas fa-edit change"></i><i id='email_confirm' data-sibling='email_edit' data-change='email' class="fas fa-check-circle change confirm" style="display: none;"></i> </span> </p>

                    <p>Address :<input class="form-control" type="text" id='address' disabled  value="{{supplier.address}}">  <span> <i id='address_edit' data-sibling='address_confirm' data-change='address'  class="fas fa-edit change"></i><i id='address_confirm' data-sibling='address_edit' data-change='address' class="fas fa-check-circle change confirm" style="display: none;"></i> </span> </p>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
$('.change').click(function(e)
{
a = e
$(e.target ).toggle();
$('#'+a.target.dataset.sibling).toggle()
$('#'+ e.target.dataset.change).prop('disabled', function (_, val) { return ! val; });


});

$('.confirm').click(function(e)
{
a = e

val = $('#'+a.target.dataset.change).val();
console.log(val);
change = update_supplier_info ( e.target.dataset.change , val );
change.then( () =>
{
    console.log('yay');
    //alert = $("<div></div>").attr('role','alert').addClass('alert alert-success').text('This is a success')
    //$('#cont_product').prepend(alert);
    console.log(e);
    $('#'+ e.target.dataset.sibling).toggleClass('fa-check fa-edit');
    $('#'+ e.target.dataset.change).css('background-color' , 'lightgreen');
    setTimeout(function()
    {
        $('#'+ e.target.dataset.sibling).toggleClass('fa-check fa-edit');
        $('.form-control').css('background-color' , '');
    }, 1200);
});
});


function update_supplier_info(input , value)
{
    return new Promise((resolve, reject) =>
    {
        data = {'input':input,
                'value':value};
        
            $.ajax({
                type: "POST",
                url: '/supplier_update_info',
                contentType: 'application/json',
                data:JSON.stringify (data),
                dataType : "json" ,
                success: function (response)
                    {
                    console.log(response);
                    if (response[0] == true) {resolve(response);}
                    else {reject(response);};
                    }
    });
})};



$("#file").change(function() {
    readURL(this);
    });

function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function(e)
        {
        $('#img').attr('src', e.target.result);
        $('#preview').css('display' , 'block');
        }
        reader.readAsDataURL(input.files[0]);
    }
    };


$("#but_upload").click(function(){

    var fd = new FormData();
    var files = $('#file')[0].files[0];
    fd.append('file',files);
    fd.append('pid',product_data.id  )

    $.ajax({
        url: '/edit_product_pic',
        type: 'post',
        data: fd,
        contentType: false,
        processData: false,
        dataType: 'json',
        success: function(response)
        {
            console.log(response);
            res = response;
            console.log(res);
            $('#product_img').attr('src', response[1] )
            $('#preview').css('display' , 'none');
        }});
    });


</script>


{% endblock %}